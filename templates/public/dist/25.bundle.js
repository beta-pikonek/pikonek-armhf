(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{1109:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return T}));var o=n(1),r=n.n(o),a=n(1093),i=n(1094),c=n(1068),l=n(1089),u=n(1095),s=n(1069),f=n(1063),p=(n(928),n(186)),m=n(938);function d(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"startAndStop",value:function(e){return new Promise((function(t,n){p.a.http({url:m.a.PACKAGE_URL+"/pihole",data:e}).POST.then((function(e){t(e.data)})).catch((function(e){n(e)}))}))}},{key:"getAptLog",value:function(){return new Promise((function(e,t){p.a.http({url:m.a.LOG_URL+"/pihole"}).GET.then((function(t){e(t.data)})).catch((function(e){t(e)}))}))}},{key:"getPihole",value:function(){return new Promise((function(e,t){p.a.http({url:m.a.PACKAGE_URL+"/pihole"}).GET.then((function(t){e(t.data)})).catch((function(e){t(e)}))}))}}])&&d(t.prototype,n),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),h=n(936),b=n.n(h),v=n(945);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t,n,o,r,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(o,r)}function E(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function i(e){g(a,o,r,i,c,"next",e)}function c(e){g(a,o,r,i,c,"throw",e)}i(void 0)}))}}function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=_(e);if(t){var r=_(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return O(this,n)}}function O(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}(m,e);var t,n,o,p=S(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=p.call(this,e)).getPihole=E(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.piholeService.getPihole();case 3:(n=e.sent).response.error||t.setState({is_running:n.response.is_running}),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])}))),t.runPiHole=function(e){var n="start"===e.action?"Start":"Stop";b.a.fire({title:"".concat(n),text:e.message,cancelButtonText:"No",showCancelButton:!0,showLoaderOnConfirm:!0,preConfirm:function(){return t.piholeService.startAndStop(e).then((function(e){return e})).catch((function(e){console.error(e)}))},allowOutsideClick:function(){return!b.a.isLoading()}}).then((function(n){n.isConfirmed&&(n.value.error?b.a.fire({text:n.value.message,icon:"error"}):t.setState({initiate:!0},t.eventsource(e.action)))}))},t.loadPiholeLog=E(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.piholeService.getAptLog();case 2:n=e.sent,t.setState({log:n});case 4:case"end":return e.stop()}}),e)}))),t.eventsource=function(e){var t=document.getElementById("alInfo"),n=document.getElementById("alSuccess"),o=document.getElementById("alError"),r=document.getElementById("output"),a=document.getElementById("btnAction");if("function"!=typeof EventSource)return r.style.display="block",void(r.innerHTML="Not supported with this browser!");var i=new EventSource("/api/package/management/pihole/"+e);r.innerHTML="",r.style.display="block",t.style.display="block",n.style.display="none",o.style.display="none",i.addEventListener("message",(function(e){-1!==e.data.indexOf("[/]")?n.style.display="block":-1!==e.data.indexOf("[x]")&&(o.style.display="block");var t="";-1!==e.data.indexOf("[i]")?(t+=e.data+"\n",r.append(t)):(t+=e.data+"\n",r.append(t),i.close(),setTimeout((function(){window.location.reload()}),3e3))}),!1),i.addEventListener("error",(function(){setTimeout((function(){t.style.display="none"}),2e3),i.close(),a.removeAttribute("disabled"),setTimeout((function(){window.location.reload()}),4e3)}),!1)},t.piholeService=new y,t.state={log:"",initiate:!1,is_running:!1},t}return t=m,(n=[{key:"componentDidMount",value:function(){this.getPihole()}},{key:"render",value:function(){var e=this;return r.a.createElement(a.a,null,r.a.createElement(i.a,{lg:"12"},r.a.createElement(c.a,null,r.a.createElement(l.a,null,r.a.createElement(u.a,null,r.a.createElement("h4",null,"Pihole is ",this.state.is_running?"running":"stopped"))),r.a.createElement(v.a.Consumer,null,(function(t){var n=t.license_status;return t.need_reboot,t.checkReboot,r.a.createElement(r.a.Fragment,null,"Active"===n?r.a.createElement(s.a,null,e.state.is_running?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(f.a,{color:"info",className:"mb-2"},"Use your PiKonek password to log in the pihole dashboard. If trouble logging in, please reset your password.")),r.a.createElement("button",{type:"button",className:"btn btn-info action-btn-wifi",onClick:function(){return window.open("http://".concat(window.location.hostname,":8080/admin"))}},r.a.createElement("i",{className:"fa fa-arrow-right"}),r.a.createElement("span",null," Go to pihole admin"))," ",r.a.createElement("button",{id:"btnAction",type:"button",className:"btn btn-danger action-btn-wifi",disabled:e.state.initiate,onClick:function(t){return e.runPiHole({status:!1,action:"stop",message:"Are you sure you want to stop pihole? This will disable the dns service and you must enable the pikonek dns service."})}},r.a.createElement("i",{className:"fa fa-stop"}),r.a.createElement("span",null," Stop"))," "):r.a.createElement("button",{id:"btnAction",type:"button",disabled:e.state.initiate,className:"btn btn-success action-btn-wifi",onClick:function(t){return e.runPiHole({status:!1,action:"start",message:"Are you sure you want to start pihole? This will make your default dns service."})}},r.a.createElement("i",{className:"fa fa-play"}),r.a.createElement("span",null," Start")),r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",null),r.a.createElement(f.a,{id:"alInfo",color:"info",className:"mb-4 mt-4",style:{display:"none"}},"This may take a while. ",r.a.createElement("strong",null,"Please do not navigate away from or close this page.")),r.a.createElement(f.a,{id:"alSuccess",color:"success",className:"mb-4 mt-4",style:{display:"none"}},"Success!"),r.a.createElement(f.a,{id:"alError",color:"danger",className:"mb-4 mt-4",style:{display:"none"}},"Error!"),r.a.createElement("pre",{id:"output",style:{width:"100%",height:"100%",display:"none"}}))):r.a.createElement(f.a,{color:"danger",className:"mb-4 mt-4"},r.a.createElement("span",null,"You are using a trial version of the system. Please purchase a license to enable pihole.")))})))))}}])&&P(t.prototype,n),o&&P(t,o),Object.defineProperty(t,"prototype",{writable:!1}),m}(o.Component)}}]);